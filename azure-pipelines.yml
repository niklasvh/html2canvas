trigger:
- master

jobs:
  - job: Browser_Tests_Linux_Firefox_Stable
    displayName: Linux Firefox Stable
    pool:
      vmImage: 'Ubuntu-16.04'
    variables:
      TARGET_BROWSER: Firefox_Stable
    steps:
    - task: NodeTool@0
      inputs:
        versionSpec: '10.x'
      displayName: 'Install Node.js'
    - task: Npm@0
      inputs:
        command: install
    - script: npm run build
      displayName: Build
    - script: Xvfb :99 &
      displayName: 'Start Xvfb'
    - script: DISPLAY=:99 npm run karma
      displayName: 'Run Firefox tests - Firefox Stable'
    - task: PublishTestResults@2
      condition: succeededOrFailed()
      inputs:
        testRunner: JUnit
        testResultsFiles: 'tmp/junit/*.xml'
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: 'tmp/reftests'
  - job: Browser_Tests_Linux_Chrome_Stable
    displayName: Linux Chrome Stable
    pool:
      vmImage: 'Ubuntu-16.04'
    variables:
      TARGET_BROWSER: Chrome_Stable
    steps:
    - task: NodeTool@0
      inputs:
        versionSpec: '10.x'
      displayName: 'Install Node.js'
    - task: Npm@0
      inputs:
        command: install
    - script: npm run build
      displayName: Build
    - script: Xvfb :99 &
      displayName: 'Start Xvfb'
    - script: DISPLAY=:99 npm run karma
      displayName: 'Run Chrome tests - Chrome Stable'
    - task: PublishTestResults@2
      condition: succeededOrFailed()
      inputs:
        testRunner: JUnit
        testResultsFiles: 'tmp/junit/*.xml'
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: 'tmp/reftests'
  - job: Browser_Tests_OSX_Safari_Stable
    displayName: OSX Safari Stable
    pool:
      vmImage: 'macOS-10.13'
    variables:
      TARGET_BROWSER: Safari_Stable
    steps:
    - task: NodeTool@0
      inputs:
        versionSpec: '10.x'
      displayName: 'Install Node.js'
    - task: Npm@0
      inputs:
        command: install
    - script: npm run build
      displayName: Build
    - script: npm run karma
      displayName: 'Run Safari tests - Safari Stable'
    - task: PublishTestResults@2
      condition: succeededOrFailed()
      inputs:
        testRunner: JUnit
        testResultsFiles: 'tmp/junit/*.xml'
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: 'tmp/reftests'
  - job: Browser_Tests_Windows_IE9
    displayName: Windows Internet Explorer 9 (Emulated)
    pool:
      vmImage: 'vs2017-win2016'
    variables:
      TARGET_BROWSER: IE_9
    steps:
    - task: NodeTool@0
      inputs:
        versionSpec: '10.x'
      displayName: 'Install Node.js'
    - task: Npm@0
      inputs:
        command: install
    - script: npm run build
      displayName: Build
    - script: npm run karma
      displayName: 'Run Internet Explorer tests - IE 9'
    - task: PublishTestResults@2
      condition: succeededOrFailed()
      inputs:
        testRunner: JUnit
        testResultsFiles: 'tmp/junit/*.xml'
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: 'tmp/reftests'
  - job: Browser_Tests_Windows_IE10
    displayName: Windows Internet Explorer 10 (Emulated)
    pool:
      vmImage: 'vs2017-win2016'
    variables:
      TARGET_BROWSER: IE_10
    steps:
    - task: NodeTool@0
      inputs:
        versionSpec: '10.x'
      displayName: 'Install Node.js'
    - task: Npm@0
      inputs:
        command: install
    - script: npm run build
      displayName: Build
    - script: npm run karma
      displayName: 'Run Internet Explorer tests - IE 10'
    - task: PublishTestResults@2
      condition: succeededOrFailed()
      inputs:
        testRunner: JUnit
        testResultsFiles: 'tmp/junit/*.xml'
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: 'tmp/reftests'
  - job: Browser_Tests_Windows_IE11
    displayName: Windows Internet Explorer 11
    pool:
      vmImage: 'vs2017-win2016'
    variables:
      TARGET_BROWSER: IE_11
    steps:
    - task: NodeTool@0
      inputs:
        versionSpec: '10.x'
      displayName: 'Install Node.js'
    - task: Npm@0
      inputs:
        command: install
    - script: npm run build
      displayName: Build
    - script: npm run karma
      displayName: 'Run Internet Explorer tests - IE 11'
    - task: PublishTestResults@2
      condition: succeededOrFailed()
      inputs:
        testRunner: JUnit
        testResultsFiles: 'tmp/junit/*.xml'
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: 'tmp/reftests'
